<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Horóscopo do Dia • horoscopohoje.app</title>
  <meta name="description" content="Horóscopo do dia por signo com Relacionamentos, Sorte, Trabalho e Astral." />
  <link rel="canonical" href="https://horoscopohoje.app/" />
  <meta name="theme-color" content="#f4ecff" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800;900&display=swap" rel="stylesheet">
  <!-- Preload do GIF do canto -->
  <link rel="preload" as="image" href="https://cdn.pixabay.com/animation/2023/11/29/03/39/03-39-03-19_512.gif" />
  <style>
    :root{
      --bg:#ffffff; --bg-grad:#f6efff; --text:#231b3a; --muted:#6f5c93; --stroke:#eadbff;
      --accent:#8a3dff; --accent2:#ff4fb6;
      --g1:#16a34a; --g2:#22c55e; --g3:#a3e635; --btn-shadow:0 12px 26px rgba(34,197,94,.25);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;color:var(--text);font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;background:
      radial-gradient(1200px 800px at 20% -10%, var(--bg-grad) 0%, #fff 55%), #fff;}
    a{color:inherit;text-decoration:none}
    .wrapper{max-width:1120px;margin:0 auto;padding:22px}
    header{display:flex;align-items:center;gap:10px;margin:6px 0 16px}
    header h1{margin:0;font-size:28px;font-weight:900;letter-spacing:.3px;
      background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;background-clip:text;color:transparent}

    .view{display:none}.view.active{display:block}

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
    @media (min-width:720px){.grid{grid-template-columns:repeat(4,1fr)}}
    .sign-tile{display:flex;flex-direction:column;align-items:center;gap:8px;padding:14px;border:1px solid var(--stroke);border-radius:16px;background:#fff;transition:transform .12s,box-shadow .12s}
    .sign-tile:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(138,61,255,.18)}
    .sign-tile img{width:88px;height:88px;object-fit:contain}
    .sign-name{font-weight:800}.sign-dates{color:var(--muted);font-size:12px}

    /* Botão START: maiúsculo, degradê, pulsante e estado de carregamento */
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 18px;border-radius:14px;border:0;cursor:pointer;text-transform:uppercase;letter-spacing:.4px;font-weight:900;color:#fff;background:linear-gradient(135deg,var(--g1),var(--g2) 55%,var(--g3));box-shadow:var(--btn-shadow);transition:transform .08s,filter .12s}
    .btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)}
    .btn.pulse{animation:pulse 1.4s ease-in-out infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.035)}100%{transform:scale(1)}}
    .btn.loading{position:relative;pointer-events:none;opacity:.92;filter:grayscale(.05)}
    .btn.loading::after{content:"";width:16px;height:16px;border:2px solid rgba(255,255,255,.55);border-top-color:#fff;border-radius:50%;position:absolute;right:12px;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .btn:disabled{opacity:.55;cursor:not-allowed;animation:none}

    .back{margin-bottom:10px}
    .start{margin:14px 0 22px}

    .sign-head{display:flex;align-items:center;gap:14px;margin:10px 0 4px}
    .sign-head img{width:66px;height:66px;object-fit:contain}
    .sign-title{display:flex;flex-direction:column;gap:2px}
    .sign-title h2{margin:0;font-size:22px}.sign-title small{color:var(--muted)}

    .section{margin:14px 0}
    .section h3{margin:0 0 8px;font-size:18px;color:var(--g1)} /* TÍTULOS EM VERDE */
    .content{min-height:60px}
    .divider{height:1px;background:linear-gradient(90deg,transparent,var(--stroke),transparent);margin:14px 0}

    /* Skeleton do conteúdo */
    .skeleton{position:relative;overflow:hidden;background:linear-gradient(90deg,#f4ecff,#efe6ff,#f4ecff);min-height:60px;border-radius:8px}
    .skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(0,0,0,.06),transparent);animation:shimmer 1.4s infinite}
    @keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}

    /* Carrossel de promos (substitui banner) */
    .carousel{display:none;position:relative;overflow:hidden;border-radius:12px;border:1px solid var(--stroke);margin-top:10px}
    .carousel-track{display:flex;width:100%;transition:transform .45s ease}
    .carousel a{flex:0 0 100%}
    .carousel img{display:block;width:100%;height:auto}
    .car-ctrl{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.85);border:0;width:36px;height:36px;border-radius:50%;cursor:pointer;font-weight:900}
    .car-ctrl:active{transform:translateY(-50%) scale(.98)}
    .car-prev{left:8px}.car-next{right:8px}

    /* GIF fixo no canto inferior direito */
    .corner-gif{position:fixed;right:14px;bottom:14px;width:42px;height:42px;border-radius:9px;overflow:hidden;z-index:60;border:1px solid rgba(0,0,0,.08);box-shadow:0 6px 16px rgba(0,0,0,.12)}
    .corner-gif img{width:100%;height:100%;display:block}

    /* Cookies */
    .cookies{position:fixed;left:12px;right:12px;bottom:12px;background:#ffffff;border:1px solid var(--stroke);border-radius:14px;padding:12px;display:none;z-index:50}
    .cookies.show{display:block}.cookies p{margin:0 0 8px;color:#3a2c61}.cookies .row{display:flex;gap:10px;flex-wrap:wrap}
    .cookies a{color:var(--accent)}
  </style>
</head>
<body>
  <div class="wrapper">
    <header><h1>HORÓSCOPO DO DIA</h1></header>

    <!-- HOME -->
    <section id="home" class="view active">
      <p style="color:var(--muted);margin:10px 0 16px">Escolha seu signo para ver as leituras de hoje.</p>
      <div id="grid" class="grid"></div>
    </section>

    <!-- SIGN PAGE -->
    <section id="signPage" class="view">
      <button class="btn back" id="btnBack" aria-label="Voltar">VOLTAR</button>

      <div class="sign-head">
        <img id="signImg" alt="">
        <div class="sign-title">
          <h2 id="signName">Signo</h2>
          <small id="signDates"></small>
        </div>
      </div>

      <button id="btnStart" class="btn start pulse">START • GERAR ANÁLISE DE HOJE</button>

      <div class="section" id="sec-rel">
        <h3>Relacionamentos</h3>
        <div class="content" id="relacionamentos"><div class="skeleton"></div></div>
        <div class="divider"></div>
      </div>

      <div class="section" id="sec-sor">
        <h3>Sorte</h3>
        <div class="content" id="sorte"><div class="skeleton"></div></div>

        <!-- CARROSSEL (só aparece após gerar) -->
        <div class="carousel" id="promoCarousel" aria-label="Ofertas">
          <div class="carousel-track" id="promoTrack">
            <a href="https://asa.bet" target="_blank" rel="noopener" aria-label="Abrir oferta 1">
              <img src="https://i.postimg.cc/hPjN9qny/image.png" alt="Oferta especial 1">
            </a>
            <a href="https://asa.bet" target="_blank" rel="noopener" aria-label="Abrir oferta 2">
              <img src="https://i.postimg.cc/QMpzX8gt/image.png" alt="Oferta especial 2">
            </a>
            <a href="https://asa.bet" target="_blank" rel="noopener" aria-label="Abrir oferta 3">
              <img src="https://i.postimg.cc/LX83r2NG/image.png" alt="Oferta especial 3">
            </a>
          </div>
          <button class="car-ctrl car-prev" id="carPrev" aria-label="Anterior">‹</button>
          <button class="car-ctrl car-next" id="carNext" aria-label="Próximo">›</button>
        </div>
        <div class="divider"></div>
      </div>

      <div class="section" id="sec-tra">
        <h3>Trabalho</h3>
        <div class="content" id="trabalho"><div class="skeleton"></div></div>
        <div class="divider"></div>
      </div>

      <div class="section" id="sec-ast">
        <h3>Astral</h3>
        <div class="content" id="astral"><div class="skeleton"></div></div>
      </div>
    </section>
  </div>

  <!-- GIF fixo no canto -->
  <a class="corner-gif" href="https://asa.bet" target="_blank" rel="noopener" aria-label="Ir para asa.bet">
    <img src="https://cdn.pixabay.com/animation/2023/11/29/03/39/03-39-03-19_512.gif" alt="Atalho para oferta">
  </a>

  <!-- Cookies -->
  <div id="cookies" class="cookies">
    <p>Usamos cookies e tecnologias semelhantes para personalizar sua experiência, medir e melhorar serviços e publicidade. Ao continuar, você concorda com nossa <a href="/privacidade" target="_blank" rel="noopener">Política de Privacidade</a> e <a href="/termos" target="_blank" rel="noopener">Termos de Uso</a>.</p>
    <div class="row">
      <button id="cookiesAccept" class="btn">PROSSEGUIR</button>
      <a class="btn" href="/preferencias-cookies">PREFERÊNCIAS</a>
    </div>
  </div>

  <script>
    // ========= CONFIG =========
    const API_URL = "https://api.horoscopohoje.app/api/horoscope";

    // ========= SIGNOS =========
    const SIGNS = [
      { id:"aries",nome:"Áries",datas:"21/03 a 19/04",img:"https://i.postimg.cc/cJcdPHw0/image.png"},
      { id:"touro",nome:"Touro",datas:"20/04 a 20/05",img:"https://i.postimg.cc/m2FBBVCd/image.png"},
      { id:"gemeos",nome:"Gêmeos",datas:"21/05 a 21/06",img:"https://i.postimg.cc/Gmwr2Yjb/image.png"},
      { id:"cancer",nome:"Câncer",datas:"22/06 a 22/07",img:"https://i.postimg.cc/VNz898TT/image.png"},
      { id:"leao",nome:"Leão",datas:"23/07 a 22/08",img:"https://i.postimg.cc/zvHZDXbL/image.png"},
      { id:"virgem",nome:"Virgem",datas:"23/08 a 22/09",img:"https://i.postimg.cc/c1vrtRf3/image.png"},
      { id:"libra",nome:"Libra",datas:"23/09 a 22/10",img:"https://i.postimg.cc/Qx5C0j4x/image.png"},
      { id:"escorpiao",nome:"Escorpião",datas:"23/10 a 21/11",img:"https://i.postimg.cc/sxWj6JJ0/image.png"},
      { id:"sagitario",nome:"Sagitário",datas:"22/11 a 21/12",img:"https://i.postimg.cc/1XDSc39k/image.png"},
      { id:"capricornio",nome:"Capricórnio",datas:"22/12 a 19/01",img:"https://i.postimg.cc/htDnTnNY/image.png"},
      { id:"aquario",nome:"Aquário",datas:"20/01 a 18/02",img:"https://i.postimg.cc/hGhqZrDb/image.png"},
      { id:"peixes",nome:"Peixes",datas:"19/02 a 20/03",img:"https://i.postimg.cc/Y9WBMCmv/image.png"}
    ];

    // ========= ELEMENTOS =========
    const grid=document.getElementById("grid"),homeView=document.getElementById("home"),signView=document.getElementById("signPage");
    const btnBack=document.getElementById("btnBack"),btnStart=document.getElementById("btnStart");
    const elName=document.getElementById("signName"),elDates=document.getElementById("signDates"),elImg=document.getElementById("signImg");
    const elRel=document.getElementById("relacionamentos"),elSor=document.getElementById("sorte"),elTra=document.getElementById("trabalho"),elAst=document.getElementById("astral");
    const promoCarousel=document.getElementById("promoCarousel"), promoTrack=document.getElementById("promoTrack");
    const carPrev=document.getElementById("carPrev"), carNext=document.getElementById("carNext");

    // ========= HELPERS =========
    function todayISO(){ return new Date().toISOString().slice(0,10); }
    function cacheKey(signId){ return `horo:${todayISO()}:${signId}`; }
    function lockKey(signId){ return `horo:lock:${todayISO()}:${signId}`; }
    function isLocked(signId){ return !!localStorage.getItem(lockKey(signId)); }
    function lockToday(signId){ localStorage.setItem(lockKey(signId),"1"); }

    function msUntilMidnight(){
      const now=new Date();
      const midnight=new Date(now); midnight.setHours(24,0,0,0);
      return midnight-now;
    }
    function scheduleMidnightRefresh(){
      setTimeout(()=>{ // ao virar o dia, reavalia a tela atual
        setView(location.hash);
        scheduleMidnightRefresh();
      }, msUntilMidnight()+1000);
    }

    // ========= GRID =========
    function renderGrid(){
      grid.innerHTML="";
      SIGNS.forEach(s=>{
        const a=document.createElement("a");
        a.className="sign-tile"; a.href=`#/${s.id}`;
        a.innerHTML=`<img src="${s.img}" alt="${s.nome}"><div class="sign-name">${s.nome}</div><div class="sign-dates">${s.datas}</div>`;
        grid.appendChild(a);
      });
    }

    // ========= VIEW =========
    function setView(hash){
      const id=(hash||"").replace("#/","").trim();
      const s=SIGNS.find(x=>x.id===id);
      if(s){
        elName.textContent=s.nome; elDates.textContent=s.datas; elImg.src=s.img; elImg.alt=s.nome;

        // carrega cache se existir
        const cached=localStorage.getItem(cacheKey(s.id));
        if(cached){
          try{ paintSections(JSON.parse(cached)); }catch{ showSkeletons(); }
        }else{
          showSkeletons();
        }

        // botão: pulsante se não bloqueado; se bloqueado, desabilita
        const locked=isLocked(s.id);
        btnStart.disabled=locked;
        btnStart.classList.toggle("pulse", !locked);
        btnStart.classList.remove("loading");

        // carrossel só aparece depois que gerar (ou se já houver cache hoje)
        if((cached && JSON.parse(cached)?.sorte) || locked){ promoCarousel.style.display="block"; }
        else { promoCarousel.style.display="none"; }

        homeView.classList.remove("active"); signView.classList.add("active");
      }else{
        signView.classList.remove("active"); homeView.classList.add("active");
      }
    }

    function showSkeletons(){
      [elRel,elSor,elTra,elAst].forEach(el=>el.innerHTML=`<div class="skeleton"></div>`);
      promoCarousel.style.display="none";
    }

    btnBack.addEventListener("click",()=>{ location.hash=""; });

    btnStart.addEventListener("click",async()=>{
      const id=(location.hash||"").replace("#/",""); const s=SIGNS.find(x=>x.id===id); if(!s) return;

      // Se já bloqueado hoje, não gera novamente
      if(isLocked(s.id)) return;

      btnStart.classList.add("loading"); btnStart.disabled=true; btnStart.classList.remove("pulse");
      showSkeletons();

      const ok=await generateAnalysis(s.id,s.nome);
      btnStart.classList.remove("loading");
      // trava até 00:00 (mantém resultados visíveis)
      if(ok){ lockToday(s.id); promoCarousel.style.display="block"; }
    });

    async function generateAnalysis(signId, signName){
      const key=cacheKey(signId);
      const body={ sign:signId, sign_label:signName, date:todayISO() };
      try{
        const res=await fetch(API_URL,{ method:"POST", headers:{ "Content-Type":"application/json" }, body:JSON.stringify(body) });
        if(!res.ok) throw new Error("Falha na API");
        const data=await res.json();
        const filled={ relacionamentos:data.relacionamentos||"", sorte:data.sorte||"", trabalho:data.trabalho||"", astral:data.astral||"" };
        paintSections(filled);
        localStorage.setItem(key,JSON.stringify(filled));
        return true;
      }catch(err){
        paintError(); console.error(err); return false;
      }
    }

    function paintSections(d){
      elRel.textContent=d.relacionamentos; elSor.textContent=d.sorte; elTra.textContent=d.trabalho; elAst.textContent=d.astral;
    }
    function paintError(){
      const msg="Não foi possível gerar a análise agora. Tente novamente em instantes.";
      [elRel,elSor,elTra,elAst].forEach(el=>el.textContent=msg);
    }

    // ========= CARROSSEL =========
    let carIndex=0, carTimer=null;
    function showSlide(i){
      const total=promoTrack.children.length;
      carIndex=(i+total)%total;
      promoTrack.style.transform=`translateX(-${carIndex*100}%)`;
    }
    function startAutoSlide(){
      if(carTimer) clearInterval(carTimer);
      carTimer=setInterval(()=>showSlide(carIndex+1), 4500);
    }
    carPrev.addEventListener("click",()=>{ showSlide(carIndex-1); startAutoSlide(); });
    carNext.addEventListener("click",()=>{ showSlide(carIndex+1); startAutoSlide(); });

    // ========= COOKIES =========
    const cookiesBox=document.getElementById("cookies"), cookiesAccept=document.getElementById("cookiesAccept"), COOKIE_KEY="cookieConsent";
    function checkCookies(){ if(!localStorage.getItem(COOKIE_KEY)) cookiesBox.classList.add("show"); }
    cookiesAccept?.addEventListener("click",()=>{ localStorage.setItem(COOKIE_KEY, JSON.stringify({acceptedAt:Date.now()})); cookiesBox.classList.remove("show"); });

    // ========= INIT =========
    renderGrid();
    setView(location.hash);
    window.addEventListener("hashchange",()=>setView(location.hash));
    checkCookies();
    scheduleMidnightRefresh();
    startAutoSlide();
  </script>
</body>
</html>
